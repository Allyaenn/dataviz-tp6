<!DOCTYPE html>
<meta charset="utf-8">
<style>

  .links line {
    stroke: #999;
    stroke-opacity: 0.6;
  }

  .nodes circle {
    stroke: #fff;
    stroke-width: 1.5px;
  }

</style>
<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

    var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    var color = d3.scaleOrdinal(d3.schemeCategory20);

    var simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(function(d) { return d.id; }))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height / 2));

    d3.json("scrutins.json", function(error, graph) {
        if (error) throw error;

        //calcul des votes communs en parcourant les scrutins
        // recupérer paire de votants + valeur
        //construire une table contenant les personnes
        console.log(graph);

        //var personnes = [];
        var vPours = [];
        var vContres = [];
        //console.log("test2 : " +  graph.scrutins.scrutin.length);
        for (var i = 0; i<graph.scrutins.scrutin.length;i++){ // parcours des scrutins
            //console.log(i);
            vPours.length = 0;
            vContres.length =0;
            for (var j = 0; j<graph.scrutins.scrutin[i].ventilationVotes.organe.groupes.groupe.length;j++) //parcours des groupes
            {
                //console.log(graph.scrutins.scrutin[i].ventilationVotes.organe.groupes.groupe[j].organeRef);

                if (graph.scrutins.scrutin[i].ventilationVotes.organe.groupes.groupe[j].vote.decompteNominatif.contres != null)
                {

                    for (var k = 0; k < graph.scrutins.scrutin[i].ventilationVotes.organe.groupes.groupe[j].vote.decompteNominatif.contres.votant.length; k++) {
                        vContres.push(graph.scrutins.scrutin[i].ventilationVotes.organe.groupes.groupe[j].vote.decompteNominatif.contres.votant[k].acteurRef);
                    }

                }

                if (graph.scrutins.scrutin[i].ventilationVotes.organe.groupes.groupe[j].vote.decompteNominatif.pours != null)
                {
                    for (var l = 0; l < graph.scrutins.scrutin[i].ventilationVotes.organe.groupes.groupe[j].vote.decompteNominatif.pours.votant.length; l++) {
                        vPours.push(graph.scrutins.scrutin[i].ventilationVotes.organe.groupes.groupe[j].vote.decompteNominatif.pours.votant[l].acteurRef);
                    }
                }
                if (i == 1) {
                    console.log(j);
                }
            }

            if (i == 1){
                console.log(vPours);
                console.log(vContres);
            }

            //parcours des tableaux vPours et vContres pour créer les paires de votants

        }

      /* var link = svg.append("g")
       .attr("class", "links")
       .selectAll("line")
       .data(graph.links)
       .enter().append("line")
       .attr("stroke-width", function(d) { return Math.sqrt(d.value); });

       var node = svg.append("g")
       .attr("class", "nodes")
       .selectAll("circle")
       .data(graph.acteurs)
       .enter().append("circle")
       .attr("r", 5)
       .attr("fill", function(d) { return d; })
       .call(d3.drag()
       .on("start", dragstarted)
       .on("drag", dragged)
       .on("end", dragended));

       node.append("title")
       .text(function(d) { return d.id; });

       simulation
       .nodes(graph.nodes)
       .on("tick", ticked);

       simulation.force("link")
       .links(graph.links);

       function ticked() {
       link
       .attr("x1", function(d) { return d.source.x; })
       .attr("y1", function(d) { return d.source.y; })
       .attr("x2", function(d) { return d.target.x; })
       .attr("y2", function(d) { return d.target.y; });

       node
       .attr("cx", function(d) { return d.x; })
       .attr("cy", function(d) { return d.y; });
       }*/
    });

    function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }

    function dragged(d) {
        d.fx = d3.event.x;
        d.fy = d3.event.y;
    }

    function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }

</script>